<!DOCTYPE html>
<html>
<head>
  <title>Simple Chess App</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.css" />
  <style>
    #board { width: 400px; }
    #controls { margin-top: 15px; }
    button { padding: 8px 12px; margin-right: 8px; }
  </style>
</head>
<body>
  <div id="board"></div>
  <div id="controls">
    <button id="playHuman">Play Human vs Human</button>
    <button id="playAI">Play vs AI</button>
  </div>

  <!-- Add jQuery first -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Then chess.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

  <!-- Then chessboard.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.js"></script>

  <script>
    let board, game;
    let aiEnabled = false;
    let aiDepth = 1; // Default difficulty

    window.onload = function() {
      game = new Chess();
      board = Chessboard('board', {
        draggable: true,
        position: 'start',
        onDrop: onDrop
      });

      // Buttons
      document.getElementById('playHuman').onclick = () => startHumanGame();
      document.getElementById('playAI').onclick = () => showDifficultyMenu();
    };

    function startHumanGame() {
      aiEnabled = false;
      game.reset();
      board.position('start');
    }

    function showDifficultyMenu() {
      let difficulty = prompt("Select difficulty: Easy (1), Medium (2), Hard (3)");
      if (difficulty === "1") aiDepth = 1;
      else if (difficulty === "2") aiDepth = 2;
      else if (difficulty === "3") aiDepth = 3;
      aiEnabled = true;
      game.reset();
      board.position('start');
    }

    function onDrop(source, target) {
      // Check if move is legal
      let move = game.move({ from: source, to: target, promotion: 'q' });
      if (move === null) return 'snapback';

      // If AI mode, make AI move
      if (aiEnabled && !game.game_over()) {
        setTimeout(makeAIMove, 250);
      }
    }

    function makeAIMove() {
      let bestMove = getBestMove(game, aiDepth);
      game.move(bestMove);
      board.position(game.fen());
    }

    function getBestMove(game, depth) {
      if (depth === 1) {
        // EASY: Random move
        let moves = game.moves();
        return moves[Math.floor(Math.random() * moves.length)];
      }
      // MEDIUM/HARD: Minimax
      return minimaxRoot(depth, game, true);
    }

    function minimaxRoot(depth, game, isMaximizingPlayer) {
      let newGameMoves = game.moves();
      let bestMove = -Infinity;
      let bestMoveFound;

      for (let i = 0; i < newGameMoves.length; i++) {
        let move = newGameMoves[i];
        game.move(move);
        let value = minimax(depth - 1, game, -Infinity, Infinity, !isMaximizingPlayer);
        game.undo();
        if (value > bestMove) {
          bestMove = value;
          bestMoveFound = move;
        }
      }
      return bestMoveFound;
    }

    function minimax(depth, game, alpha, beta, isMaximizingPlayer) {
      if (depth === 0) {
        return -evaluateBoard(game.board());
      }

      let newGameMoves = game.moves();

      if (isMaximizingPlayer) {
        let bestMove = -Infinity;
        for (let i = 0; i < newGameMoves.length; i++) {
          game.move(newGameMoves[i]);
          bestMove = Math.max(bestMove, minimax(depth - 1, game, alpha, beta, !isMaximizingPlayer));
          game.undo();
          alpha = Math.max(alpha, bestMove);
          if (beta <= alpha) break;
        }
        return bestMove;
      } else {
        let bestMove = Infinity;
        for (let i = 0; i < newGameMoves.length; i++) {
          game.move(newGameMoves[i]);
          bestMove = Math.min(bestMove, minimax(depth - 1, game, alpha, beta, !isMaximizingPlayer));
          game.undo();
          beta = Math.min(beta, bestMove);
          if (beta <= alpha) break;
        }
        return bestMove;
      }
    }

    function evaluateBoard(board) {
      const values = { p: 1, n: 3, b: 3, r: 5, q: 9, k: 1000 };
      let eval = 0;
      for (let row of board) {
        for (let piece of row) {
          if (piece) {
            eval += piece.color === 'w' ? values[piece.type] : -values[piece.type];
          }
        }
      }
      return eval;
    }
  </script>
</body>
</html>
