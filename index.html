<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Chess</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.css"/>
    <style>
        body {
            background: #2b2b2b;
            color: white;
            text-align: center;
            font-family: Arial, sans-serif;
        }
        #board {
            width: 90vw;
            max-width: 500px;
            margin: 20px auto;
        }
        #status {
            margin-top: 10px;
            font-size: 1.2rem;
        }
        button {
            margin: 5px;
            padding: 8px 15px;
            border: none;
            background: #4CAF50;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover { background: #45a049; }
    </style>
</head>
<body>
    <h1>â™Ÿ Web Chess</h1>
    <div id="board"></div>
    <div id="status">Game on!</div>
    <button onclick="resetGame()">Restart</button>
    <button onclick="setMode('pvp')">Two-Player</button>
    <button onclick="setMode('easy')">Easy AI</button>
    <button onclick="setMode('medium')">Medium AI</button>
    <button onclick="setMode('hard')">Hard AI</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.13.4/chess.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.js"></script>
    <script>
        let game = new Chess();
        let board = null;
        let mode = 'pvp'; // pvp, easy, medium, hard

        function onDragStart(source, piece) {
            if (game.game_over()) return false;
            if (mode !== 'pvp' && game.turn() === 'b') return false; // Player is always white in AI mode
            if ((game.turn() === 'w' && piece.search(/^b/) !== -1) ||
                (game.turn() === 'b' && piece.search(/^w/) !== -1)) return false;
        }

        function onDrop(source, target) {
            let move = game.move({ from: source, to: target, promotion: 'q' });
            if (move === null) return 'snapback';
            updateStatus();

            if (mode !== 'pvp' && !game.game_over()) {
                setTimeout(makeAIMove, 250);
            }
        }

        function makeAIMove() {
            let moves = game.moves();
            let move;
            if (mode === 'easy') {
                // Easy: random move
                move = moves[Math.floor(Math.random() * moves.length)];
            } else if (mode === 'medium') {
                // Medium: pick best by material
                move = getBestMoveMedium();
            } else if (mode === 'hard') {
                // Hard: Use Stockfish (to implement)
                move = moves[Math.floor(Math.random() * moves.length)];
            }
            game.move(move);
            board.position(game.fen());
            updateStatus();
        }

        function getBestMoveMedium() {
            let bestMove = null;
            let bestScore = -9999;
            let moves = game.moves();
            moves.forEach(m => {
                game.move(m);
                let score = evaluateBoard(game.board());
                game.undo();
                if (score > bestScore) {
                    bestScore = score;
                    bestMove = m;
                }
            });
            return bestMove;
        }

        function evaluateBoard(board) {
            let values = { p: 1, n: 3, b: 3, r: 5, q: 9, k: 0 };
            let score = 0;
            for (let row of board) {
                for (let piece of row) {
                    if (piece) {
                        score += piece.color === 'w' ? values[piece.type] : -values[piece.type];
                    }
                }
            }
            return score;
        }

        function updateStatus() {
            let status = '';
            let moveColor = (game.turn() === 'w') ? 'White' : 'Black';
            if (game.in_checkmate()) {
                status = `Game over, ${moveColor} is in checkmate.`;
            } else if (game.in_draw()) {
                status = 'Draw!';
            } else {
                status = `${moveColor} to move`;
                if (game.in_check()) status += `, ${moveColor} is in check.`;
            }
            document.getElementById('status').textContent = status;
            board.position(game.fen());
        }

        function resetGame() {
            game.reset();
            board.start();
            updateStatus();
        }

        function setMode(newMode) {
            mode = newMode;
            resetGame();
        }

        board = Chessboard('board', {
            draggable: true,
            position: 'start',
            onDragStart: onDragStart,
            onDrop: onDrop
        });

        updateStatus();
    </script>
</body>
</html>
